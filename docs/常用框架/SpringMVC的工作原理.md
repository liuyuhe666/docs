# SpringMVC çš„å·¥ä½œåŸç†

SpringMVCï¼ˆSpring Web MVCï¼‰æ˜¯ Spring Framework æä¾›çš„ä¸€ä¸ª **åŸºäºæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰è®¾è®¡æ¨¡å¼** çš„ Web æ¡†æ¶ï¼Œç”¨äºç®€åŒ– Web åº”ç”¨çš„å¼€å‘ã€‚
å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯æŠŠ **è¯·æ±‚å¤„ç†ã€ä¸šåŠ¡é€»è¾‘ã€è§†å›¾æ¸²æŸ“** åˆ†ç¦»å¼€ï¼Œä½¿ç³»ç»Ÿæ›´æ¸…æ™°ã€æ˜“æ‰©å±•ã€å¯ç»´æŠ¤ã€‚

## ğŸŒ SpringMVC çš„æ•´ä½“å·¥ä½œæµç¨‹

ä¸‹é¢æ˜¯ SpringMVC çš„å…¸å‹å·¥ä½œåŸç†ï¼ˆè¯·æ±‚æ‰§è¡Œæµç¨‹ï¼‰ï¼š

```
å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰
    â†“
DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰
    â†“
HandlerMappingï¼ˆå¤„ç†å™¨æ˜ å°„å™¨ï¼‰
    â†“
Handlerï¼ˆå¤„ç†å™¨ / Controllerï¼‰
    â†“
HandlerAdapterï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰
    â†“
ModelAndViewï¼ˆæ¨¡å‹ä¸è§†å›¾ï¼‰
    â†“
ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼‰
    â†“
Viewï¼ˆè§†å›¾æ¸²æŸ“ï¼‰
    â†“
å“åº”ç»“æœè¿”å›å®¢æˆ·ç«¯
```

## âš™ï¸ è¯¦ç»†æµç¨‹è¯´æ˜ï¼ˆé€æ­¥åˆ†æï¼‰

### 1ï¸âƒ£ å®¢æˆ·ç«¯å‘é€è¯·æ±‚

ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ª URLï¼Œæ¯”å¦‚ï¼š

```
http://localhost:8080/user/list
```

è¿™ä¸ªè¯·æ±‚ä¼šå…ˆè¢« `DispatcherServlet`ï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰æ‹¦æˆªã€‚

> åœ¨ web.xml æˆ– Spring Boot è‡ªåŠ¨é…ç½®ä¸­ï¼Œ`DispatcherServlet` æ˜¯æ‰€æœ‰è¯·æ±‚çš„å…¥å£ã€‚

### 2ï¸âƒ£ DispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚

`DispatcherServlet` æ˜¯ SpringMVC çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ•´ä¸ªè¯·æ±‚æµç¨‹çš„è°ƒåº¦ã€‚

å®ƒä¸å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ï¼š

- æŸ¥æ‰¾å¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼ˆControllerï¼‰
- è°ƒç”¨å¯¹åº”çš„å¤„ç†å™¨é€‚é…å™¨
- è°ƒç”¨è§†å›¾è§£æå™¨æ¸²æŸ“ç»“æœ

### 3ï¸âƒ£ HandlerMappingï¼šæŸ¥æ‰¾å¤„ç†å™¨

`DispatcherServlet` ä¼šé€šè¿‡ **`HandlerMapping`** æ ¹æ® URL æ‰¾åˆ°å¯¹åº”çš„ **å¤„ç†å™¨ï¼ˆHandlerï¼‰**ã€‚

æ¯”å¦‚ï¼š

```java
@Controller
@RequestMapping("/user")
public class UserController {

    @GetMapping("/list")
    public String list(Model model) {
        model.addAttribute("users", userService.findAll());
        return "userList";
    }
}
```

`HandlerMapping` æ ¹æ®è¯·æ±‚ `/user/list` æ‰¾åˆ° `UserController.list()` æ–¹æ³•ã€‚

### 4ï¸âƒ£ HandlerAdapterï¼šè°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•

æ‰¾åˆ°æ§åˆ¶å™¨åï¼ŒSpringMVC è¿˜éœ€è¦ä¸€ä¸ª **`HandlerAdapter`ï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰** æ¥æ‰§è¡Œå®ƒã€‚

é€‚é…å™¨çš„ä½œç”¨æ˜¯å±è”½ä¸åŒç±»å‹æ§åˆ¶å™¨ä¹‹é—´çš„å·®å¼‚ï¼Œä½¿ DispatcherServlet ä¸å¿…å…³å¿ƒå…·ä½“çš„è°ƒç”¨ç»†èŠ‚ã€‚

### 5ï¸âƒ£ æ‰§è¡Œ Controllerï¼ˆHandlerï¼‰

`HandlerAdapter` è´Ÿè´£çœŸæ­£è°ƒç”¨ `Controller` ä¸­çš„æ–¹æ³•ã€‚

æ§åˆ¶å™¨æ‰§è¡Œåé€šå¸¸ä¼šè¿”å›ï¼š

- é€»è¾‘è§†å›¾åï¼ˆå¦‚ `"userList"`ï¼‰
- æˆ–ä¸€ä¸ª `ModelAndView` å¯¹è±¡ï¼ŒåŒ…å«æ¨¡å‹æ•°æ®å’Œè§†å›¾åã€‚

### 6ï¸âƒ£ è¿”å› ModelAndView

æ§åˆ¶å™¨æ‰§è¡Œåè¿”å›ï¼š

```java
return new ModelAndView("userList", model);
```

æˆ–ç®€åŒ–ä¸ºï¼š

```java
return "userList";
```

DispatcherServlet æ¥æ”¶è¿™ä¸ªç»“æœï¼Œå‡†å¤‡è¿›å…¥è§†å›¾è§£æé˜¶æ®µã€‚

### 7ï¸âƒ£ ViewResolverï¼šè§£æè§†å›¾

`DispatcherServlet` ä¼šè°ƒç”¨ **`ViewResolver`ï¼ˆè§†å›¾è§£æå™¨ï¼‰**ï¼ŒæŠŠé€»è¾‘è§†å›¾åè§£ææˆçœŸæ­£çš„è§†å›¾å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ JSPã€Thymeleaf æ¨¡æ¿ã€Freemarker ç­‰ï¼‰ã€‚

ä¾‹å¦‚ï¼š

- é€»è¾‘è§†å›¾å `"userList"`
- è§†å›¾è§£æå™¨é…ç½®ï¼š

  ```properties
  spring.mvc.view.prefix=/WEB-INF/views/
  spring.mvc.view.suffix=.jsp
  ```

- è§£æç»“æœï¼š`/WEB-INF/views/userList.jsp`

### 8ï¸âƒ£ View æ¸²æŸ“

è§†å›¾ï¼ˆViewï¼‰æ‹¿åˆ°æ¨¡å‹æ•°æ® `Model`ï¼Œæ¸²æŸ“æˆæœ€ç»ˆçš„ HTML é¡µé¢ã€‚

æœ€ç»ˆç»“æœé€šè¿‡ `DispatcherServlet` è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

## ğŸ§© SpringMVC æ ¸å¿ƒç»„ä»¶æ€»ç»“

| ç»„ä»¶                      | è§’è‰²         | ä½œç”¨                            |
| ------------------------- | ------------ | ------------------------------- |
| **DispatcherServlet**     | å‰ç«¯æ§åˆ¶å™¨   | ç»Ÿä¸€è¯·æ±‚å…¥å£ï¼Œè°ƒåº¦å…¶ä»–ç»„ä»¶      |
| **HandlerMapping**        | å¤„ç†å™¨æ˜ å°„å™¨ | æ ¹æ® URL æ‰¾åˆ°å¯¹åº”çš„ Controller  |
| **HandlerAdapter**        | å¤„ç†å™¨é€‚é…å™¨ | æ‰§è¡Œå¯¹åº”çš„ Controller æ–¹æ³•      |
| **Handlerï¼ˆControllerï¼‰** | å¤„ç†å™¨       | æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿”å› ModelAndView |
| **ModelAndView**          | æ¨¡å‹ä¸è§†å›¾   | å°è£…è¿”å›çš„æ•°æ®å’Œè§†å›¾ä¿¡æ¯        |
| **ViewResolver**          | è§†å›¾è§£æå™¨   | å°†é€»è¾‘è§†å›¾åè§£ææˆå…·ä½“è§†å›¾      |
| **View**                  | è§†å›¾         | æ¸²æŸ“é¡µé¢ï¼Œç”Ÿæˆå“åº”å†…å®¹          |

## ğŸ§  ç®€å•ç¤ºæ„å›¾

```
        +----------------------+
        |  DispatcherServlet   |
        +----------+-----------+
                   |
                   v
        +----------+-----------+
        |     HandlerMapping   |
        +----------+-----------+
                   |
                   v
        +----------+-----------+
        |      Controller       |
        +----------+-----------+
                   |
                   v
        +----------+-----------+
        |    ViewResolver       |
        +----------+-----------+
                   |
                   v
              [HTML é¡µé¢è¾“å‡º]
```

## ğŸ“˜ SpringMVC çš„ä¼˜ç‚¹

- âœ… èŒè´£åˆ†æ˜ï¼šæ¸…æ™°çš„ MVC åˆ†å±‚ç»“æ„

- âœ… æ¾è€¦åˆï¼šå„ç»„ä»¶ç‹¬ç«‹å¯æ›¿æ¢

- âœ… å¯æ‰©å±•æ€§å¼ºï¼šæ”¯æŒè‡ªå®šä¹‰æ‹¦æˆªå™¨ã€è§†å›¾è§£æå™¨ã€å¼‚å¸¸è§£æå™¨ç­‰

- âœ… ä¸ Spring æ— ç¼é›†æˆï¼šå¯æ–¹ä¾¿ä½¿ç”¨ IoCã€AOPã€äº‹åŠ¡ç®¡ç†ç­‰ç‰¹æ€§

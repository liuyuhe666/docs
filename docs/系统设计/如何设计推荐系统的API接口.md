# 如何设计推荐系统的 API 接口

推荐服务的 API 设计应遵循 RESTful 原则，力求简洁、清晰、易于使用。一个良好的设计能够隐藏后端复杂的算法逻辑，为前端提供稳定统一的接口。

## 1. 核心设计原则

- **RESTful 风格**：使用标准 HTTP 方法，资源定义明确。
- **通用性**：接口应能适配不同推荐场景（如首页信息流、相关推荐、猜你喜欢等）。
- **简洁性**：请求参数不宜过多，将复杂的逻辑收敛到服务端。
- **可缓存性**：对 GET 请求的响应设计合理的缓存策略，降低后端压力。
- **版本控制**：在 URL（如`/api/v1/recommend`）或 Header 中引入版本号，便于后续迭代。

## 2. 一个典型的推荐 API 端点

**Endpoint:**

```
GET /api/v1/recommendations
```

**请求参数 (Request Parameters):**

| 参数名     | 类型        | 是否必须 | 描述                                                                                                                                                                                                  |
| :--------- | :---------- | :------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `scene`    | string      | **是**   | **推荐场景**。这是最重要的参数，用于指定在哪使用推荐结果。例如：`home_feed` (首页信息流), `article_detail` (文章详情页相关推荐), `shopping_cart` (购物车猜你喜欢)等。后端根据场景调用不同的策略组合。 |
| `userId`   | string      | 否       | 用户 ID。用于个性化推荐。如果匿名用户，可以传设备 ID 或留空。                                                                                                                                         |
| `itemId`   | string      | 否       | 内容/商品 ID。在相关推荐、相似推荐等场景下使用。例如在文章详情页，需要传当前文章的 ID。                                                                                                               |
| `category` | string      | 否       | 类别筛选。例如希望推荐结果集中在“科技”类目下。                                                                                                                                                        |
| `size`     | int         | 否       | 返回结果的数量，默认为 10，最大不超过 100（防止资源耗尽）。                                                                                                                                           |
| `context`  | JSON Object | 否       | **扩展上下文信息**。这是一个非常灵活的参数，用于传递各种可能影响推荐的实时因素。例如：`{"fromPage": "search", "searchKeyword": "iPhone"}`, `{"currentTime": "night"}`, `{"location": "Beijing"}`。    |

**响应体 (Response Body):**

```json
{
  "request_id": "a1b2c3d4e5f6", // 本次请求的唯一ID，用于问题排查
  "code": 200,
  "msg": "success",
  "data": {
    "scene": "home_feed",
    "items": [
      {
        "item_id": "1001",
        "item_type": "article", // 内容类型：article, video, product等
        "title": "推荐系统详解",
        "author": "AI研究员",
        "score": 0.987, // 推荐得分，可用于客户端排序或调试
        "image_url": "...",
        "link_url": "...",
        "reason": "因为你喜欢人工智能" // 推荐理由，提升用户体验
      }
      // ... 更多推荐结果
    ]
  }
}
```

## 3. 为什么这样设计？

- `scene` 参数：将业务场景与策略解耦。客户端无需关心后端逻辑，只需告诉服务端“我在哪里用”，服务端负责配置该场景下应该使用哪些策略和算法。
- `context` 参数：提供了极大的灵活性。未来任何新的上下文信息（如天气、网络环境）都可以通过此字段传递，而无需修改 API 结构，保证了向前兼容。
- 响应中的 `score` 和 `reason`：对调试和产品体验非常友好。后端可以知道每个物品为何被推荐，客户端也可以选择性地展示推荐理由。
